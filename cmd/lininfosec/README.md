LinInfoSec
==========

LinInfoSec is a CVE monitoring tool exposing a REST API for monitoring CVE feeds for publications affecting software configurations.

It exposes the following API:

- '/monitor/add' accepting HTTP POST requests, to add a configuration of software to monitor 
- '/monitor/remove' accepting HTTP POST requests, to remove a configuration of software to monitor 
- '/monitor/update' accepting HTTP POST requests, to remove a configuration of software to monitor 
- '/monitor/get' accepting HTTP GET requests, to remove a configuration of software to monitor 
- '/searchCPE' accepting HTTP GET requests, to search among the CPE dictionnary
- '/productVersions' accepting HTTP GET requests, to search among the CPE dictionnary

Configuration
-------------

To run, lininfosec requires a set of environnement variables to be defined:

- `LININFOSEC_MYSQL_DSN` needs to be set to a mysql DSN (ex: `username:password@protocol(address)/dbname?param=value`)
- `LININFOSEC_DATA_DIR` needs to be set to a data directory to store the CVEs and the cpe dictionnary
- `LININFOSEC_NOTIFICATION_ENDPOINT` needs to be set to a URL where the vulnerability notifications will be sent.

Adding configurations
---------------------

The endpoint to add configurations to monitor is `/monitor/add` accepting a POST request with a json body:

```json
{
	"configuration": "host1.foo.bar",
	"cpes": [
		"cpe:2.3:a:foocorp:foo:1.3.4:*:*:*:*:*:*:*",
		"cpe:2.3:a:barcorp:bar:1.12:*:*:*:*:*:*:*",
	]
}
```

The configuration is the unique name of the configuration. It must be generated by the client and unique.
If the configuration already exists or if the cpes array is empty, error code 400 will be returned by LinInfoSec, otherwise, status code 204.

Getting configurations
----------------------

The endpoint to add configurations to monitor is `/monitor/get` accepting a GET request with a `name` query.

The configuration is the unique name of the configuration.
If the configuration doesn't exists, error code 400 will be returned by LinInfoSec, otherwise, status code 200 with the body containing the configuration:

```json
{
	"configuraiton": "host1.foo.bar",
	"cpes": [
		"cpe:2.3:a:foocorp:foo:1.3.4:*:*:*:*:*:*:*",
		"cpe:2.3:a:barcorp:bar:1.12:*:*:*:*:*:*:*",
	]
}
```


Removing configurations
-----------------------

The endpoint to stop monitoring configurations is `/monitor/remove` accepting a POST request with the body following the JSON schema:

```json
{
	"configuration": "host1.foo.bar"
}
```

The configuration is the unique name of the configuration.
If the configuration doesn't exist error code 400 will be returned by LinInfoSec, otherwise, status code 204 is returned.

Updating configurations
-----------------------

The endpoint to stop monitoring configurations is `/monitor/update` accepting a POST request with the body following the JSON schema:

```json
{
	"configuration": "host1.foo.bar",
	"cpes": [
		"cpe:2.3:a:foocorp:foo:1.3.4:*:*:*:*:*:*:*",
		"cpe:2.3:a:barcorp:bar:1.12:*:*:*:*:*:*:*",
	]
}
```

The configuration is the unique name of the configuration.
The configuration array will replace the previous array for the given configuration.
If the configuration already exists or if the cpes array is empty, error code 400 will be returned by LinInfoSec, otherwise, status code 204.

Searching CPEs
--------------

The endpoint to search among the CPE dictionary is `/searchCPE` accepting a GET request with the following query parameters:

- `search` search string 
- `vendor`, `product`, `url` for additional information to improve search results when available (the url can be a link to the software website or github repo, it will be used to match against the `references` fields in the cpe dictionary)
- `start` and `count` for pagination

The search results are send in the following format, returning the minimum version in the dictionary for every dictionary item matching the query.

The result is the following JSON object:

```json
{
	"total": 53,
	"data": [
		{
			"uri" : "cpe:2.3:a:foocorp:foo:-:*:*:*:*:*:*:*",
			"part": "a"
			"vendor": "foocorp",
			"product": "foo",
			"title": "foo software",
		},
		{
			"uri" : "cpe:2.3:a:barcorp:bar:-:*:*:*:*:*:*:*",
			"part": "a"
			"vendor": "barcorp",
			"product": "bar",
			"title": "bar software",
		}
	]
}
```

The total field informs of the total amount of results that can be obtained with the pagination.

CPE information
---------------

Since the search endpoint only returns the minimum version for each product, it is necessary fetch additional information for those CPEs, mainly, all the existing versions for a given product.
It is possible to fetch additional information from the dictionary for a given CPE with the `/productVersions` endpoint. It accepts GET requests with the following query parameters:

- `vendor`, `product`, `part` of the requested product
- `start` and `count` for pagination

The response is either `null` if the uri doesn't exist or the following json object:

```json
{
	"total": 10,
	"data": [
		{
			"uri" : "cpe:2.3:a:foocorp:foo:1.2.3:*:*:*:*:*:*:*",
			"vendor": "foocorp",
			"product": "foo",
			"version": "1.2.3",
			"updatecl": "*",
			"edition": "*",
			"swedition": "*",
			"targetSW": "*",
			"targethw": "*",
			"other": "*",
			"language": "*",
			"title": "Foo software version 1.2.3",
			"references": [
				{
					"url": "foocorp.org/foo123",
					"description": "software page"
				},
				{
					"url": "foocorp.org/foo123",
					"description": "software page"
				}
			]
		}
	]
}
```

Notifications
-------------

It fetches regularly the CVE feeds from NVD. It then compares new CVE publications with the configurations being monitored.
When a vulnerability is detected a HTTP POST request is sent to a configured endpoint with the list of vulnerabilities in JSON schema:

```json
[
	{
		"configuration" : "host1.foo.bar",
		"cve" :  " as described by the NVD cve json schema: CVE_JSON_4.0_min_1.1.schema"
	}
]
```
